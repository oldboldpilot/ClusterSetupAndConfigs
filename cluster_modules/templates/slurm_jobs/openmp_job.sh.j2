#!/bin/bash
#SBATCH --job-name={{ job_name }}
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task={{ num_threads }}
#SBATCH --time={{ time_limit }}
#SBATCH --partition={{ partition }}
#SBATCH --output={{ output_file }}
#SBATCH --error={{ error_file }}

# OpenMP Job Script Generated by ClusterSetupAndConfigs
# Author: Olumuyiwa Oluwasanmi
# Framework: OpenMP (libomp)

echo "======================================"
echo "OpenMP Job: {{ job_name }}"
echo "======================================"
echo "Job ID: $SLURM_JOB_ID"
echo "Node: $SLURM_NODELIST"
echo "Threads: {{ num_threads }}"
echo "Start time: $(date)"
echo "======================================"
echo ""

# Load environment
export PATH=/home/linuxbrew/.linuxbrew/bin:$PATH
export LD_LIBRARY_PATH=/home/linuxbrew/.linuxbrew/lib:$LD_LIBRARY_PATH

# OpenMP configuration
export OMP_NUM_THREADS={{ num_threads }}
export OMP_PROC_BIND=true
export OMP_PLACES=cores

echo "OpenMP Environment:"
echo "  OMP_NUM_THREADS=$OMP_NUM_THREADS"
echo "  OMP_PROC_BIND=$OMP_PROC_BIND"
echo "  OMP_PLACES=$OMP_PLACES"
echo ""

# Run OpenMP application
echo "Executing: {{ executable }} {{ args }}"
echo ""

{{ executable }} {{ args }}

EXIT_CODE=$?

echo ""
echo "======================================"
echo "Job completed with exit code: $EXIT_CODE"
echo "End time: $(date)"
echo "======================================"

exit $EXIT_CODE
