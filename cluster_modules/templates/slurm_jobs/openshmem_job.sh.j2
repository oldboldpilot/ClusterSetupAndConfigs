#!/bin/bash
#SBATCH --job-name={{ job_name }}
#SBATCH --nodes={{ num_nodes }}
#SBATCH --ntasks={{ num_pes }}
#SBATCH --time={{ time_limit }}
#SBATCH --partition={{ partition }}
#SBATCH --output={{ output_file }}
#SBATCH --error={{ error_file }}

# OpenSHMEM Job Script Generated by ClusterSetupAndConfigs
# Author: Olumuyiwa Oluwasanmi
# Framework: OpenSHMEM 1.5.3

echo "======================================"
echo "OpenSHMEM Job: {{ job_name }}"
echo "======================================"
echo "Job ID: $SLURM_JOB_ID"
echo "Nodes: {{ num_nodes }}"
echo "Processing Elements: {{ num_pes }}"
echo "Start time: $(date)"
echo "======================================"
echo ""

# Load environment
export PATH={{ openshmem_install }}/bin:/home/linuxbrew/.linuxbrew/bin:$PATH
export LD_LIBRARY_PATH={{ openshmem_install }}/lib:/home/linuxbrew/.linuxbrew/lib:$LD_LIBRARY_PATH

# OpenSHMEM configuration
export SHMEM_INSTALL={{ openshmem_install }}

echo "OpenSHMEM Environment:"
echo "  SHMEM_INSTALL=$SHMEM_INSTALL"
echo ""

# Run OpenSHMEM application
echo "Executing: {{ executable }} {{ args }}"
echo ""

srun --mpi=pmix {{ executable }} {{ args }}

EXIT_CODE=$?

echo ""
echo "======================================"
echo "Job completed with exit code: $EXIT_CODE"
echo "End time: $(date)"
echo "======================================"

exit $EXIT_CODE
